{"pageProps":{"title":"20 years of experience in web animations with JavaScript","description":"Exploring CSS transition, CSS animation, and web animations API gotchas, and how to overcome a hug gotcha in web animations API.","socialImage":"/blog/20-years-of-experience-in-web-animations-with-javascript/blur-train.jpg","content":"<p>This post is a note-taking from <a href=\"https://www.youtube.com/watch?v=9-6CKCz58A8\" target=\"_blank\" rel='noopener'>Google Chrome Developers video</a> where Jake and Surma talks about Jake's journey with web animations.</p>\n<h2>Table of content</h2>\n<ul>\n<li><a href=\"#css-transition\">CSS transition</a></li>\n<li><a href=\"#transition-problem\">CSS transition problem</a></li>\n<li><a href=\"#css-animation\">CSS animation</a></li>\n<li><a href=\"#web-animations-api\">Web animations API</a></li>\n<li><a href=\"#fill-forwards-gotcha\">Fill forwards gotcha</a></li>\n<li><a href=\"#fill-forwards-solution\">ðŸŒŸ Fill forwards solution</a></li>\n</ul>\n<p>We will start the journey by first exploring the CSS transition.</p>\n<h2>CSS transition <a name=\"css-transition\"></a></h2>\n<p>We will start the journey by first exploring the CSS transition.</p>\n<div class=\"remark-highlight\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\"><span class=\"token class\">.box</span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">transition</span><span class=\"token punctuation\">:</span> opacity <span class=\"token number\">500</span><span class=\"token unit\">ms</span> ease-in-out<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">opacity</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>This is nice when you need to make hover effects for example <strong>which is done in CSS</strong>.</p>\n<div class=\"remark-highlight\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\"><span class=\"token class\">.box</span><span class=\"token pseudo-class\">:hover</span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">opacity</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h2>Transition problem <a name=\"transition-problem\"></a></h2>\n<p>Troubles start to come when using JavaScript for making transitions, For example, when a user clicks a button we want to start a transition.</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>body</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>button</span> <span class=\"token attr-name\">onclick</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>onClickHandler()<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Click me<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>button</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>body</span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">onClickHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> el <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"div\"</span><span class=\"token punctuation\">)</span>\n  el<span class=\"token punctuation\">.</span><span class=\"token property-access\">style</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">opacity</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"0\"</span>\n  <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">body</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">append</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">)</span>\n  el<span class=\"token punctuation\">.</span><span class=\"token property-access\">style</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">transition</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"opacity 500ms ease-in-out\"</span>\n  el<span class=\"token punctuation\">.</span><span class=\"token property-access\">style</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">opacity</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"1\"</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p><strong>Do you see the problem?</strong>\n<img src=\"/blog/20-years-of-experience-in-web-animations-with-javascript/transition-problem.gif\" alt=\"No transition happens when the button clicks\" title=\"Transition Problem\"></p>\n<p>The problem is that the browser doesn't see the <code>opacity 0</code>; because the browser's render engine skips it, So the workaround is to use the <code>getComputedStyle(el).opacity</code>, since calling <code>getComputedStyle(el)</code> is not enough, <strong>we have to specify the opacity and then the browser will start to think of the style</strong>.</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">onClickHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> el <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"div\"</span><span class=\"token punctuation\">)</span>\n  el<span class=\"token punctuation\">.</span><span class=\"token property-access\">style</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">opacity</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"0\"</span>\n  <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">body</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">append</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">)</span>\n<span class=\"remark-highlight-code-line\">  <span class=\"token function\">getComputedStyle</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">opacity</span>\n</span>  el<span class=\"token punctuation\">.</span><span class=\"token property-access\">style</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">transition</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"opacity 500ms ease-in-out\"</span>\n  el<span class=\"token punctuation\">.</span><span class=\"token property-access\">style</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">opacity</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"1\"</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p><img src=\"/blog/20-years-of-experience-in-web-animations-with-javascript/transition-solution.gif\" alt=\"Transition now works when the button is clicked\" title=\"Transition Solution\"></p>\n<p><strong>Removing the element</strong></p>\n<p>Now we want to fade the element out, so</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\">el<span class=\"token punctuation\">.</span><span class=\"token property-access\">style</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">opacity</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"0\"</span>\n</code></pre></div>\n<p>Easy right? Now we want to remove it from the document after the animation is done, so we listen to the <code>transitionend</code> event.</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\">el<span class=\"token punctuation\">.</span><span class=\"token property-access\">style</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">opacity</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"0\"</span>\nel<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"transitionend\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  el<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p><strong>Do you see the problem?</strong></p>\n<p>Not a problem if you didn't figure this one out, it's somewhat complicated, the problem is event bubbling (you can read more about this from <a href=\"https://en.wikipedia.org/wiki/Event_bubbling\">Wikipedia</a> or from <a href=\"https://javascript.info/bubbling-and-capturing\">javascript.info</a>). If the element you are listening to transitionend on had a parent that also has a transition going on (complicated transition scenario), the parent will also listen to that event and will be also removed from the dom. So we have to check that the element listening for the transitionend event is the one we expect.</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\">el<span class=\"token punctuation\">.</span><span class=\"token property-access\">style</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">opacity</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"0\"</span>\nel<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"transitionend\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"remark-highlight-code-line\">  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span><span class=\"token property-access\">target</span> <span class=\"token operator\">!==</span> el<span class=\"token punctuation\">)</span> <span class=\"token keyword control-flow\">return</span>\n</span>  el<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<h2>CSS animation <a name=\"css-animation\"></a></h2>\n<p>With the slightly newer CSS animations this just works</p>\n<div class=\"remark-highlight\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token atrule\"><span class=\"token rule\">@keyframes</span> fade-in</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token selector\">from</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">opacity</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> el <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"div\"</span><span class=\"token punctuation\">)</span>\nel<span class=\"token punctuation\">.</span><span class=\"token property-access\">style</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">animation</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"fade-in 500ms ease-in-out\"</span>\n<span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">body</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">append</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>For fading out and removing</p>\n<div class=\"remark-highlight\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token atrule\"><span class=\"token rule\">@keyframes</span> fade-in</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token selector\">from</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">opacity</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"remark-highlight-code-line\"><span class=\"token atrule\"><span class=\"token rule\">@keyframes</span> fade-out</span> <span class=\"token punctuation\">{</span>\n</span><span class=\"remark-highlight-code-line\">  <span class=\"token selector\">from</span> <span class=\"token punctuation\">{</span>\n</span><span class=\"remark-highlight-code-line\">    <span class=\"token property\">opacity</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n</span><span class=\"remark-highlight-code-line\">  <span class=\"token punctuation\">}</span>\n</span><span class=\"remark-highlight-code-line\"><span class=\"token punctuation\">}</span>\n</span></code></pre></div>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\">el<span class=\"token punctuation\">.</span><span class=\"token property-access\">style</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">animation</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"fade-out 500ms ease-in-out\"</span>\nel<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"transitionend\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"remark-highlight-code-line\">  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span><span class=\"token property-access\">target</span> <span class=\"token operator\">!==</span> el<span class=\"token punctuation\">)</span> <span class=\"token keyword control-flow\">return</span>\n</span>  el<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>We still need to deal with the event bubbling issue.</p>\n<h2>Web animations API <a name=\"web-animations-api\"></a></h2>\n<p>With web animations API we can now do all the animation within javascript, for fading in</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> el <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'div'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">body</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">append</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nel<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">animate</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">{</span>opacity<span class=\"token operator\">:</span> <span class=\"token string\">'0'</span><span class=\"token punctuation\">,</span> offset<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>duration<span class=\"token operator\">:</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">,</span> easing<span class=\"token operator\">:</span> <span class=\"token string\">'ease-in-out'</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>The browser by default will assume that you want to animate the opacity to 1 so there is no need to specify that.\nFor fading out</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> animation <span class=\"token operator\">=</span> el<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">animate</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">{</span>opacity<span class=\"token operator\">:</span> <span class=\"token string\">'0'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>duration<span class=\"token operator\">:</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">,</span> easing<span class=\"token operator\">:</span> <span class=\"token string\">'ease-in-out'</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nanimation<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">onfinish</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> el<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h3>Animating to a lower opacity without removing from the DOM</h3>\n<p>What if you want to animate something from whatever the opacity now to 0.3 and leave it there without removing it from the dom. Something like this:</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\">el<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">animate</span><span class=\"token punctuation\">(</span>\n<span class=\"remark-highlight-code-line\">  <span class=\"token punctuation\">{</span>opacity<span class=\"token operator\">:</span> <span class=\"token string\">\"0.3\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n</span>  <span class=\"token punctuation\">{</span>\n    duration<span class=\"token operator\">:</span> <span class=\"token number\">500</span><span class=\"token punctuation\">,</span>\n    easing<span class=\"token operator\">:</span> <span class=\"token string\">\"ease-in-out\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p><em>NOTE: Providing one keyframe implies the end keyframe, for some reason!</em></p>\n<p><strong>Now, do you see the gotcha?</strong>\n<img src=\"/blog/20-years-of-experience-in-web-animations-with-javascript/animating-to-lower-opacity.gif\" alt=\"Animating to lower opacity demo\" title=\"Animating to lower opacity problem\"></p>\n<p>The animation stops at the desired opacity, but once it is done animating the animation itself is gone, so it goes back to its original state.</p>\n<p>The solution is to use <code>fill: forwards</code></p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\">el<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">animate</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">{</span>opacity<span class=\"token operator\">:</span> <span class=\"token string\">\"0.3\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    duration<span class=\"token operator\">:</span> <span class=\"token number\">500</span><span class=\"token punctuation\">,</span>\n    easing<span class=\"token operator\">:</span> <span class=\"token string\">\"ease-in-out\"</span><span class=\"token punctuation\">,</span>\n<span class=\"remark-highlight-code-line\">    fill<span class=\"token operator\">:</span> <span class=\"token string\">\"forwards\"</span><span class=\"token punctuation\">,</span>\n</span>  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p><img src=\"/blog/20-years-of-experience-in-web-animations-with-javascript/sol-animating-to-lower-opacity.gif\" alt=\"Animating to lower opacity solution demo\" title=\"Animating to lower opacity solution\"></p>\n<h2>Fill fowrwards gotcha <a name=\"fill-forwards-gotcha\"></a></h2>\n<p>Suppose we later on decided to set the opacity of the <code>el</code> to 1</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\">el<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">animate</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">{</span>opacity<span class=\"token operator\">:</span> <span class=\"token string\">\"0.3\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    duration<span class=\"token operator\">:</span> <span class=\"token number\">500</span><span class=\"token punctuation\">,</span>\n    easing<span class=\"token operator\">:</span> <span class=\"token string\">\"ease-in-out\"</span><span class=\"token punctuation\">,</span>\n    fill<span class=\"token operator\">:</span> <span class=\"token string\">\"forwards\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span>\n<span class=\"remark-highlight-code-line\">el<span class=\"token punctuation\">.</span><span class=\"token property-access\">style</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">opacity</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"1\"</span>\n</span></code></pre></div>\n<p>This does nothing! Because the animation has a higher priority than the style and it is still running. The only thing that the animation doesn't have priority over is important styles.</p>\n<h2>ðŸŒŸ Fill fowrwards Solution <a name=\"fill-forwards-solution\"></a></h2>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">animateTo</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">element<span class=\"token punctuation\">,</span> keframes<span class=\"token punctuation\">,</span> options</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> anim <span class=\"token operator\">=</span> element<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">animate</span><span class=\"token punctuation\">(</span>keyframes<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token spread operator\">...</span>options<span class=\"token punctuation\">,</span> fill<span class=\"token operator\">:</span> <span class=\"token string\">\"both\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  anim<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"finish\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"remark-highlight-code-line\">    anim<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">commitStyles</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</span>    anim<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">cancel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"remark-highlight-code-line\">  <span class=\"token keyword control-flow\">return</span> anim\n</span><span class=\"remark-highlight-code-line\"><span class=\"token punctuation\">}</span>\n</span></code></pre></div>\n<p>Note the highlighted lines, <code>anim.commitStyles()</code> will commit the last styles applied to the element, but this doesn't happen, because at this point the animation has ended and returned to its original state, so <code>commitStyles()</code> doesn't have any effect. In order for <code>anim.commitStyles()</code> we have to use <code>fill: 'both'</code>. With <code>anim.cancel()</code> we can feel safe about the <code>fill: 'both'</code> because once the animation is finished, it's gonna be removed.</p>\n<hr>\n<p>These are my takings from <a href=\"https://www.youtube.com/watch?v=9-6CKCz58A8\" target=\"_blank\" rel='noopener'>Jake and Surma's video</a>, I hope you have enjoyed it.</p>\n","readTime":3,"date":"2021-01-02T09:57:34.439Z"},"__N_SSG":true}